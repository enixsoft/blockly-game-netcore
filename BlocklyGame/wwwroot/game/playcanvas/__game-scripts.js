var CameraController=pc.createScript("cameraController");CameraController.attributes.add("distanceX",{type:"number",default:1,title:"Distance X",description:"Additional distance to add to Camera's X position."}),CameraController.attributes.add("currentXMax",{type:"number",default:1,title:"Current X Maximum",description:"When character's X position gets higher than value of this, camera no longer follows Character."}),CameraController.attributes.add("followActive",{type:"boolean",default:!0,title:"Active Following",description:"Enables or disables following of Character. Set to false at start and gets enabled after loading of saved game."}),CameraController.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.vec=new pc.Vec3,this.target=this.app.root.findByName("character"),this.followActive=!1},CameraController.prototype.update=function(t){var e=this.target.getPosition(),a=this.entity.getPosition();if(this.followActive){if(e.x>=a.x+1*this.distanceX){var r=e.x-(a.x+1*this.distanceX);r>.01&&(e.x+=r,e.y=5,e.z=-1,e.x>this.currentXMax&&(e.x=this.currentXMax))}else{var i=a.x+1*this.distanceX-e.x;i>.01&&(e.x-=i,e.y=5,e.z=-1,e.x>this.currentXMax&&(e.x=this.currentXMax))}this.vec.lerp(this.vec,e,.1),this.entity.setPosition(this.vec)}},CameraController.prototype.changeFollow=function(t){this.followActive=0!==t&&!1!==t},CameraController.prototype.changeCurrentXMax=function(t){this.currentXMax=t},CameraController.prototype.changeDistanceX=function(t){this.distanceX=t},CameraController.prototype.save=function(){return{currentCameraPosition:this.entity.getPosition(),currentXMax:this.currentXMax,distanceX:this.distanceX}},CameraController.prototype.load=function(t){this.distanceX=t.distanceX,this.currentXMax=t.currentXMax,this.followActive=!0};var CommandInterpreter=pc.createScript("commandInterpreter");CommandInterpreter.attributes.add("startingPositionX",{type:"number",default:11}),CommandInterpreter.attributes.add("startingPositionY",{type:"number",default:4}),CommandInterpreter.attributes.add("levelSizeX",{type:"number"}),CommandInterpreter.attributes.add("levelSizeY",{type:"number"}),CommandInterpreter.attributes.add("moveSpeed",{type:"number",default:.5}),CommandInterpreter.attributes.add("mainTaskModeActive",{type:"boolean",default:!0}),CommandInterpreter.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.engine=this.app.root.findByName("engine"),this.currentTile=[],this.calculateAndSetPosition(this.startingPositionX,this.startingPositionY),this.facingDirection="right",this.entity.sprite.play("idle"),this.distance=0,this.dizzyAfterMoving=!1,this.attackAnimation=0,this.jumpAnimation=0,this.jumpDistance=0,this.lootAnimationSteps=0,this.startPosition=0,this.targetPosition=0,this.commandsCurrent=0,this.commandsSourceIsPlayer=!0,this.commandArray=[],this.idArray=[],this.functionArray=[],this.forArray=[],this.doWhileStartsAtCommand=0,this.commandBlockedByIf=!1,this.doWhileProtectionBuffer=[],this.doWhileRepeats=0,this.wallTextures=[15376209,15375751,15375849,15375870,15375872,15375874,15375890,15375891,15375893,15375895,15375897,15375899,15375901,15375903,15375905,15375907,15375909,15375911,13900899,15375913,15375915,15375917,15375919,15375921,15375923,15375925,15375927,15375929,15375931,15375933,15375935,15375937,15375939,15375941,15375943,15375945,15375947,15375949,15375951,15375953,15375955,15375957,15375959,15375970,15376668,15376555,15376623,15785848,15785975],this.waterTextures=[15375851,15375854,15375856,15375876,15375878,15375881,15375883,15375885,15375887],this.texturesArray=[this.wallTextures,this.waterTextures]},CommandInterpreter.prototype.initializeAfterStoppedExecution=function(t,i){this.app=pc.Application.getApplication(),this.engine=this.app.root.findByName("engine"),this.currentTile=[],this.calculateAndSetPosition(t,i),this.facingDirection="right",this.entity.sprite.play("idle"),this.distance=0,this.dizzyAfterMoving=!1,this.attackAnimation=0,this.jumpAnimation=0,this.jumpDistance=0,this.lootAnimationSteps=0,this.startPosition=0,this.targetPosition=0,this.commandsCurrent=0,this.commandsSourceIsPlayer=!0,this.commandArray=[],this.idArray=[],this.functionArray=[],this.forArray=[],this.doWhileStartsAtCommand=0,this.commandBlockedByIf=!1,this.doWhileProtectionBuffer=[],this.doWhileRepeats=0,this.wallTextures=[15376209,15375751,15375849,15375870,15375872,15375874,15375890,15375891,15375893,15375895,15375897,15375899,15375901,15375903,15375905,15375907,15375909,15375911,13900899,15375913,15375915,15375917,15375919,15375921,15375923,15375925,15375927,15375929,15375931,15375933,15375935,15375937,15375939,15375941,15375943,15375945,15375947,15375949,15375951,15375953,15375955,15375957,15375959,15375970,15376668,15376555,15376623,15785848,15785975],this.waterTextures=[15375851,15375854,15375856,15375876,15375878,15375881,15375883,15375885,15375887],this.texturesArray=[this.wallTextures,this.waterTextures]},CommandInterpreter.prototype.commandBufferReceiver=function(t,i,e){this.commandArray=t,this.commandsCurrent=0,this.functionArray=[],this.forArray=[],this.doWhileStartsAtCommand=0,this.commandBlockedByIf=!1,this.doWhileProtectionBuffer=[],this.doWhileRepeats=0,e?(this.commandsSourceIsPlayer=!0,this.idArray=i,this.doNextCommand()):(this.commandsSourceIsPlayer=!1,this.doNextCommand())},CommandInterpreter.prototype.doNextCommand=function(){if(this.commandsCurrent<this.commandArray.length){var t=this.commandArray[this.commandsCurrent];if(this.commandsSourceIsPlayer&&"};"!==t&&!this.commandBlockedByIf){var i=this.idArray[this.commandsCurrent].substr(1).slice(0,-1);this.engine.script.messageController.sendMessage("highlightProgress",i)}this.commandsCurrent++;var e,r=t.split("(");if("};"!==r[0]&&(e=r[1].split(")")),"};"!==r[0]&&this.commandBlockedByIf)this.doNextCommand();else switch("};"!==r[0]&&"ifNextTileIs"!==r[0]&&"ifNextTileHas"!==r[0]&&0!==this.doWhileStartsAtCommand&&this.doWhileProtectionBuffer.push(!1),r[0]){case"ifNextTileIs":case"ifNextTileHas":this.ifTileIsSetup("next",e[0]);break;case"for":this.forSetup(e[0]);break;case"};":this.functionBlockEnds();break;case"doWhileNotFinished":this.doWhileNotFinishedSetup();break;case"moveForward":this.moveForward(e[0]);break;case"jumpForward":this.jumpForward(e[0]);break;case"rotateCharacter":this.rotateCharacter(e[0]);break;case"moveRight":this.moveRight(e[0]);break;case"moveLeft":this.moveLeft(e[0]);break;case"moveUp":this.moveUp(e[0]);break;case"moveDown":this.moveDown(e[0]);break;case"attack":this.attack(e[0]);break;case"attackForward":this.attackForward();break;case"use":this.use(e[0]);break;case"useForward":this.useForward();break;case"jump":this.jump(e[0]);break;case"open":this.open(e[0]);break;case"openForward":this.openForward()}}else this.commandsAreCompleted()},CommandInterpreter.prototype.checkIfTaskWasCompleted=function(){var t,i=this.entity.script.taskController.getCurrentMainTask(),e=this.currentTile.slice();e=e[0]+"x"+e[1];var r=this.getNextTile();switch(r=r[0]+"x"+r[1],i[1]){case"moved":case"movedAndHasLoot":t=e}void 0!==this.app.root.findByName(t).script&&this.app.root.findByName(t).script.has("taskScript")?this.app.root.findByName(t).script.taskScript.checkEvent(i[1],i[3]):1===this.getActualCycle()?this.doWhileNotFinished():this.taskWasNotCompleted(i[3])},CommandInterpreter.prototype.taskWasNotCompleted=function(t){this.mainTaskModeActive?this.engine.script.messageController.sendMessage("mainTaskFailed",{currentMainTask:t,commandArray:this.commandArray}):1===this.getActualCycle()?this.doWhileNotFinished():this.engine.script.messageController.sendMessage("unlock",0)},CommandInterpreter.prototype.load=function(t){this.calculateAndSetPosition(t.currentTile[0],t.currentTile[1]),this.setFacingDirection(t.facingDirection),this.entity.sprite.play("idle")},CommandInterpreter.prototype.save=function(t){return{currentTile:this.currentTile,facingDirection:this.facingDirection}},CommandInterpreter.prototype.calculateAndSetPosition=function(t,i){this.currentTile=[t,i];var e=this.currentTile.slice();e=e[0]+"x"+e[1];var r=this.app.root.findByName(e).getPosition().clone();r.x-=.05,r.y=.5,r.z-=.6,this.entity.setPosition(r.x,r.y,r.z)},CommandInterpreter.prototype.commandFailed=function(t){var i=this.idArray[this.commandsCurrent-1].substr(1).slice(0,-1);this.engine.script.messageController.sendMessage("highlightFailure",i);var e=this.entity.script.taskController.getCurrentMainTask();this.engine.script.messageController.sendMessage("commandFailed",{currentMainTask:e[3],failureType:t,commandNumber:this.commandsCurrent,commandArray:this.commandArray})},CommandInterpreter.prototype.commandsAreCompleted=function(){1!==this.getActualCycle()&&this.entity.sprite.play("idle"),this.commandsSourceIsPlayer?this.checkIfTaskWasCompleted():this.entity.script.taskController.continueGame()},CommandInterpreter.prototype.moveForward=function(t){switch(this.facingDirection){case"right":this.moveRight(1);break;case"left":this.moveLeft(1);break;case"up":this.moveUp(1);break;case"down":this.moveDown(1)}},CommandInterpreter.prototype.jumpForward=function(t){switch(this.facingDirection){case"right":this.jump("right");break;case"left":this.jump("left");break;case"up":this.jump("up");break;case"down":this.jump("down")}},CommandInterpreter.prototype.rotateCharacter=function(t){switch(this.entity.sprite.play("idle"),this.facingDirection){case"right":"right"===t?this.changeFacingDirection("down"):this.changeFacingDirection("up");break;case"left":"right"===t?this.changeFacingDirection("up"):this.changeFacingDirection("down");break;case"up":"right"===t?this.changeFacingDirection("right"):this.changeFacingDirection("left");break;case"down":"right"===t?this.changeFacingDirection("left"):this.changeFacingDirection("right")}this.doNextCommand()},CommandInterpreter.prototype.functionBlockEnds=function(){var t=this.getActualCycle();2===t?this.forIterate():3===t?this.ifRemove():this.doNextCommand()},CommandInterpreter.prototype.getActualCycle=function(){return this.functionArray.length>0?this.functionArray[this.functionArray.length-1]:0},CommandInterpreter.prototype.ifRemove=function(){this.commandBlockedByIf=!1,this.functionArray.pop(),this.doNextCommand()},CommandInterpreter.prototype.ifTileIsSetup=function(t,i){(3!==this.getActualCycle()&&this.functionArray.push(3),"};"===this.commandArray[this.commandsCurrent])?(this.entity.sprite.play("idle"),this.commandFailed("functionerror")):(console.log("setting up ifTileIs "+t+" and type:"+i+" will start at: "+this.commandsCurrent),this.checkTileType(t,i)?(this.commandBlockedByIf=!1,0!==this.doWhileStartsAtCommand&&this.doWhileProtectionBuffer.push(!1)):(this.commandBlockedByIf=!0,0!==this.doWhileStartsAtCommand&&this.doWhileProtectionBuffer.push(!0)),this.doNextCommand())},CommandInterpreter.prototype.doWhileNotFinishedSetup=function(){this.doWhileProtectionBuffer=[],1!==this.getActualCycle()&&this.functionArray.push(1),"};"===this.commandArray[this.commandsCurrent]?(this.entity.sprite.play("idle"),this.commandFailed("functionerror")):(this.doWhileStartsAtCommand=this.commandsCurrent,console.log("setting up doWhile, will start at: "+this.doWhileStartsAtCommand),this.doNextCommand())},CommandInterpreter.prototype.forSetup=function(t){2!==this.getActualCycle()&&this.functionArray.push(2),t<1||t>50||"};"===this.commandArray[this.commandsCurrent]?(this.entity.sprite.play("idle"),this.commandFailed("functionerror")):(this.createFor=[this.commandsCurrent,0,t],this.forArray.push(this.createFor),this.doNextCommand())},CommandInterpreter.prototype.forIterate=function(){this.forArray.length>0&&(this.forArray[this.forArray.length-1][1]++,this.forArray[this.forArray.length-1][1]<this.forArray[this.forArray.length-1][2]?this.commandsCurrent=this.forArray[this.forArray.length-1][0]:(this.forArray.pop(),0===this.forArray.length&&this.functionArray.pop()),console.log("forIterate "+this.forArray)),this.doNextCommand()},CommandInterpreter.prototype.doWhileNotFinished=function(){if(this.doWhileProtectionBuffer.length>0){var t=!0;this.commandsCurrent=this.doWhileStartsAtCommand;for(var i=0;i<this.doWhileProtectionBuffer.length;i++)if(!1===this.doWhileProtectionBuffer[i]){t=!1;break}t||this.doWhileRepeats>100?(console.log("do while will not start again because commandBlockedByIf: "+this.commandBlockedByIf+"and dowhileprotectionbuffer: "),console.log(this.doWhileProtectionBuffer),this.entity.sprite.play("idle"),this.commandFailed("functionerror")):(this.doWhileProtectionBuffer=[],this.doWhileRepeats++,this.doNextCommand())}else this.doWhileRepeats<100?(this.doWhileRepeats++,this.doNextCommand()):(this.entity.sprite.play("idle"),this.commandFailed("functionerror"))},CommandInterpreter.prototype.moveRight=function(t){if(this.changeFacingDirection("right"),t<=0||t>99)this.entity.sprite.play("idle"),this.commandFailed("zerosteps");else{for(var i=t;i>=1;i--)this.checkTileForMoving("right",i)||(this.dizzyAfterMoving=!0,t=1!=i?+i-1:1);this.checkTileForMoving("right",t)?(this.startPosition=this.entity.getPosition().clone(),this.targetPosition=this.entity.getPosition().clone(),this.targetPosition.x+=1*t,this.currentTile[1]+=1*t,this.direction=new pc.Vec3,this.direction.sub2(this.targetPosition,this.startPosition),this.distance=this.direction.length(),this.direction.normalize()):this.dizzy()}},CommandInterpreter.prototype.moveLeft=function(t){if(this.changeFacingDirection("left"),t<=0||t>99)this.entity.sprite.play("idle"),this.commandFailed("zerosteps");else{for(var i=t;i>=1;i--)this.checkTileForMoving("left",i)||(this.dizzyAfterMoving=!0,t=1!=i?+i-1:1);this.checkTileForMoving("left",t)?(this.startPosition=this.entity.getPosition().clone(),this.targetPosition=this.entity.getPosition().clone(),this.targetPosition.x-=1*t,this.currentTile[1]-=1*t,this.direction=new pc.Vec3,this.direction.sub2(this.targetPosition,this.startPosition),this.distance=this.direction.length(),this.direction.normalize()):this.dizzy()}},CommandInterpreter.prototype.moveUp=function(t){if(this.changeFacingDirection("up"),t<=0||t>99)this.entity.sprite.play("idle"),this.commandFailed("zerosteps");else{for(var i=t;i>=1;i--)this.checkTileForMoving("up",i)||(this.dizzyAfterMoving=!0,t=1!=i?+i-1:1);this.checkTileForMoving("up",t)?(this.startPosition=this.entity.getPosition().clone(),this.targetPosition=this.entity.getPosition().clone(),this.targetPosition.z-=1*t,this.currentTile[0]-=1*t,this.direction=new pc.Vec3,this.direction.sub2(this.targetPosition,this.startPosition),this.distance=this.direction.length(),this.direction.normalize()):this.dizzy()}},CommandInterpreter.prototype.moveDown=function(t){if(this.changeFacingDirection("down"),t<=0||t>99)this.entity.sprite.play("idle"),this.commandFailed("zerosteps");else{for(var i=t;i>=1;i--)this.checkTileForMoving("down",i)||(this.dizzyAfterMoving=!0,t=1!=i?+i-1:1);this.checkTileForMoving("down",t)?(this.startPosition=this.entity.getPosition().clone(),this.targetPosition=this.entity.getPosition().clone(),this.targetPosition.z+=1*t,this.currentTile[0]+=1*t,this.direction=new pc.Vec3,this.direction.sub2(this.targetPosition,this.startPosition),this.distance=this.direction.length(),this.direction.normalize()):this.dizzy()}},CommandInterpreter.prototype.attack=function(t){this.facingDirection!=t&&this.changeFacingDirection(t),this.entity.sprite.play("attack"),this.entity.sprite.once("end",function(){this.checkNextTileForDestruction()},this)},CommandInterpreter.prototype.attackForward=function(){switch(this.facingDirection){case"right":this.attack("right");break;case"left":this.attack("left");break;case"up":this.attack("up");break;case"down":this.attack("down")}},CommandInterpreter.prototype.use=function(t){this.facingDirection!=t&&this.changeFacingDirection(t),this.entity.sprite.play("use"),this.entity.sprite.once("end",function(){this.checkNextTileForUse()},this)},CommandInterpreter.prototype.useForward=function(){switch(this.facingDirection){case"right":this.use("right");break;case"left":this.use("left");break;case"up":this.use("up");break;case"down":this.use("down")}},CommandInterpreter.prototype.open=function(t){this.facingDirection!=t&&this.changeFacingDirection(t),this.entity.sprite.play("use"),this.entity.sprite.once("end",function(){this.checkNextTileForOpen()},this)},CommandInterpreter.prototype.openForward=function(){switch(this.facingDirection){case"right":this.open("right");break;case"left":this.open("left");break;case"up":this.open("up");break;case"down":this.open("down")}},CommandInterpreter.prototype.jump=function(t){switch(this.facingDirection!=t&&this.changeFacingDirection(t),t){case"right":this.checkNextTileForJumping()?(this.startPosition=this.entity.getPosition().clone(),this.targetPosition=this.entity.getPosition().clone(),this.targetPosition.x+=2,this.currentTile[1]+=2,this.direction=new pc.Vec3,this.direction.sub2(this.targetPosition,this.startPosition),this.jumpDistance=this.direction.length(),this.direction.normalize()):this.dizzy();break;case"left":this.checkNextTileForJumping()?(this.startPosition=this.entity.getPosition().clone(),this.targetPosition=this.entity.getPosition().clone(),this.targetPosition.x-=2,this.currentTile[1]-=2,this.direction=new pc.Vec3,this.direction.sub2(this.targetPosition,this.startPosition),this.jumpDistance=this.direction.length(),this.direction.normalize()):this.dizzy();break;case"up":this.checkNextTileForJumping()?(this.startPosition=this.entity.getPosition().clone(),this.targetPosition=this.entity.getPosition().clone(),this.targetPosition.z-=2,this.currentTile[0]-=2,this.direction=new pc.Vec3,this.direction.sub2(this.targetPosition,this.startPosition),this.jumpDistance=this.direction.length(),this.direction.normalize()):this.dizzy();break;case"down":this.checkNextTileForJumping()?(this.startPosition=this.entity.getPosition().clone(),this.targetPosition=this.entity.getPosition().clone(),this.targetPosition.z+=2,this.currentTile[0]+=2,this.direction=new pc.Vec3,this.direction.sub2(this.targetPosition,this.startPosition),this.jumpDistance=this.direction.length(),this.direction.normalize()):this.dizzy()}this.jumpAnimation=1},CommandInterpreter.prototype.getNextTile=function(){var t=this.currentTile.slice();switch(this.facingDirection){case"right":return t[1]+=1,t;case"left":return t[1]-=1,t;case"up":return t[0]-=1,t;case"down":return t[0]+=1,t}},CommandInterpreter.prototype.checkNextTileForDestruction=function(){this.entity.sprite.play("idle");var t=this.getNextTile();t=t[0]+"x"+t[1],this.checkTileFor("destructible",t)?this.app.root.findByName(t).script.tileScript.destroy():this.doNextCommand()},CommandInterpreter.prototype.checkNextTileForJumping=function(){var t=this.getNextTile();switch(this.facingDirection){case"right":t[1]+=1;break;case"left":t[1]-=1;break;case"up":t[0]-=1;break;case"down":t[0]+=1}return t=t[0]+"x"+t[1],!!this.checkTileFor("moving",t)},CommandInterpreter.prototype.checkTileType=function(t,i){if("any"===i)return!0;var e,r=!1;"current"===t?e=(e=this.currentTile.slice())[0]+"x"+e[1]:"next"===t&&(e=(e=this.getNextTile())[0]+"x"+e[1]);var s=this.app.root.findByName(e).sprite.spriteAsset;switch(i){case"ground":r=this.checkTileFor("moving",e);break;case"wall":r=this.checkTileTextureArray(s,0);break;case"water":r=this.checkTileTextureArray(s,1);break;case"button":r=this.checkTileFor("button",e);break;case"trap":r=this.checkTileFor("death",e);break;case"destructible":r=this.checkTileFor("destructible",e);break;case"lever":r=this.checkTileFor("use",e);break;case"chest":r=this.checkTileFor("open",e)}return r},CommandInterpreter.prototype.checkTileTextureArray=function(t,i){for(var e=0;e<this.texturesArray[i].length;e++)if(t===this.texturesArray[i][e])return!0;return!1},CommandInterpreter.prototype.checkTile=function(){var t=this.currentTile.slice();t=t[0]+"x"+t[1],this.checkTileFor("death",t)?this.die():this.checkTileFor("drop",t)?this.loot():this.checkTileFor("button",t)?this.stepOnButton(t):this.doNextCommand()},CommandInterpreter.prototype.checkTileFor=function(t,i){if(null!==this.app.root.findByName(i)&&void 0!==this.app.root.findByName(i).script&&this.app.root.findByName(i).script.has("tileController")){var e;switch(t){case"moving":e=this.app.root.findByName(i).script.tileController.move;break;case"destructible":e=this.app.root.findByName(i).script.tileController.destructible;break;case"use":e=this.app.root.findByName(i).script.tileController.use;break;case"open":e=this.app.root.findByName(i).script.tileController.open;break;case"drop":e=this.app.root.findByName(i).script.tileController.drop;break;case"death":e=this.app.root.findByName(i).script.tileController.death;break;case"button":e=this.app.root.findByName(i).script.tileController.button}return!!e}return!1},CommandInterpreter.prototype.checkTileForMoving=function(t,i){var e,r,s=this.getNextTile();switch(t){case"right":e=s[0],r=+s[1]+(+i-1);break;case"left":e=s[0],r=+s[1]-(+i-1);break;case"up":e=+s[0]-(+i-1),r=s[1];break;case"down":e=+s[0]+(+i-1),r=s[1]}return!(e>this.levelSizeX||e<0||r>this.levelSizeY||r<0)&&(s=e+"x"+r,!!this.checkTileFor("moving",s))},CommandInterpreter.prototype.checkNextTileForUse=function(){this.entity.sprite.play("idle");var t=this.getNextTile();t=t[0]+"x"+t[1],this.checkTileFor("use",t)?this.app.root.findByName(t).script.tileScript.use():this.doNextCommand()},CommandInterpreter.prototype.checkNextTileForOpen=function(){this.entity.sprite.play("idle");var t=this.getNextTile();t=t[0]+"x"+t[1],this.checkTileFor("open",t)?this.app.root.findByName(t).script.tileScript.use():this.doNextCommand()},CommandInterpreter.prototype.die=function(){this.entity.sprite.play("die"),this.entity.sprite.once("end",function(){this.death()},this)},CommandInterpreter.prototype.dizzy=function(){this.dizzyAfterMoving=!1,this.entity.sprite.play("startDizzy"),this.entity.sprite.once("end",function(){this.commandFailed("dizzy"),this.entity.sprite.play("loopDizzy")},this)},CommandInterpreter.prototype.death=function(){this.entity.sprite.play("died"),this.commandFailed("death")},CommandInterpreter.prototype.lootTile=function(){var t=this.currentTile.slice();t=t[0]+"x"+t[1],this.app.root.findByName(t).script.tileScript.loot()},CommandInterpreter.prototype.loot=function(){this.entity.sprite.play("loot"),this.entity.sprite.on("end",function(){switch(this.lootAnimationSteps){case 0:this.lootAnimationSteps++,this.entity.sprite.play("looting");break;case 1:this.lootAnimationSteps++,this.entity.sprite.play("looted");break;case 2:this.entity.sprite.off("end"),this.lootAnimationSteps=0,this.lootTile(),this.doNextCommand()}},this)},CommandInterpreter.prototype.stepOnButton=function(t){this.app.root.findByName(t).script.stateController.changeState(1),this.doNextCommand()},CommandInterpreter.prototype.changeFacingDirection=function(t){if(this.facingDirection!==t)switch(this.engine.script.messageController.sendMessage("changeFacingDirection",t),t){case"right":this.facingDirection=t,this.entity.sprite.flipX=!1;break;case"left":this.facingDirection=t,this.entity.sprite.flipX=!0;break;case"up":case"down":this.facingDirection=t}},CommandInterpreter.prototype.setFacingDirection=function(t){switch(this.engine.script.messageController.sendMessage("changeFacingDirection",t),t){case"right":this.facingDirection=t,this.entity.sprite.flipX=!1;break;case"left":this.facingDirection=t,this.entity.sprite.flipX=!0;break;case"up":case"down":this.facingDirection=t}},CommandInterpreter.prototype.update=function(t){if(0!==this.distance){this.entity.sprite.play("walk");var i=this.direction.clone();i.scale(this.moveSpeed*t),this.entity.translate(i);var e=this.entity.getPosition().clone(),r=new pc.Vec3;r.sub2(this.targetPosition,e);var s=r.length();s>this.distance?(this.calculateAndSetPosition(this.currentTile[0],this.currentTile[1]),this.distance=0,this.dizzyAfterMoving?this.dizzy():this.checkTile()):this.distance=s}else if(0!==this.jumpDistance){var o,n=this.direction.clone(),a=this.entity.getPosition().clone();switch(this.facingDirection){case"right":(o=this.targetPosition.x-a.x)>1?(n=this.direction.clone()).z-=.5:(n=this.direction.clone()).z+=.5;break;case"left":(o=Math.abs(this.targetPosition.x-a.x))>1?(n=this.direction.clone()).z-=.75:(n=this.direction.clone()).z+=.75;break;case"up":o=a.z-this.targetPosition.z;break;case"down":o=Math.abs(a.z-this.targetPosition.z)}n.scale(1*t),this.entity.translate(n),o>Math.fround(1.8)&&this.entity.sprite.play("jump"),o<=Math.fround(1.8)&o>Math.fround(.4)&&this.entity.sprite.play("jumping"),o<=Math.fround(.3)&o>Math.fround(.05)&&this.entity.sprite.play("jumped"),o<=Math.fround(.05)&&(this.calculateAndSetPosition(this.currentTile[0],this.currentTile[1]),this.jumpDistance=0,this.checkTile())}};var DestructionController=pc.createScript("destructionController");DestructionController.prototype.initialize=function(){this.app=pc.Application.getApplication()},DestructionController.attributes.add("hasDrop",{type:"boolean",default:!1}),DestructionController.attributes.add("destroyed",{type:"boolean",default:!1}),DestructionController.prototype.destroy=function(){this.destroyed=!0,this.entity.sprite.play("destroy"),this.entity.sprite.once("end",function(){this.destroyed=!0,this.hasDrop?this.entity.sprite.play("drop"):this.entity.sprite.opacity=0,this.app.root.findByName("character").script.commandInterpreter.doNextCommand()},this)},DestructionController.prototype.save=function(){return this.destroyed},DestructionController.prototype.load=function(t){console.log(t.destroyed),t.destroyed?(this.destroyed=!0,t.hasOwnProperty("looted")?t.looted?this.entity.sprite.opacity=0:this.entity.sprite.play("drop"):this.entity.sprite.opacity=0):(this.destroyed=!1,this.entity.sprite.play("idle"),this.entity.sprite.opacity=1)};var UseController=pc.createScript("useController");UseController.attributes.add("targetEntity",{type:"string",default:"door"}),UseController.attributes.add("targetScript",{type:"string"}),UseController.attributes.add("usableOnce",{type:"boolean",default:!1}),UseController.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.used=!1,this.entity.sprite.play("idle")},UseController.prototype.use=function(){this.used?!0!==this.usableOnce?(this.used=!1,this.use2Function()):(this.used=!0,this.use2Function()):(this.used=!0,this.useFunction())},UseController.prototype.save=function(){return this.used},UseController.prototype.load=function(t){t.used?(this.used=!0,this.entity.sprite.play("used")):(this.used=!1,this.entity.sprite.play("idle")),this.app.root.findByName(this.targetEntity).script[this.targetScript].load(t.used)},UseController.prototype.useFunction=function(){this.entity.sprite.play("use"),this.entity.sprite.once("end",function(){this.used?this.entity.sprite.play("used"):this.entity.sprite.play("idle"),this.app.root.findByName(this.targetEntity).script[this.targetScript].use()},this)},UseController.prototype.use2Function=function(){this.entity.sprite.play("use2"),this.entity.sprite.once("end",function(){this.used?this.entity.sprite.play("used"):this.entity.sprite.play("idle"),this.app.root.findByName(this.targetEntity).script[this.targetScript].use()},this)};var Button=pc.createScript("button");Button.attributes.add("type",{type:"string"}),Button.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.engine=this.app.root.findByName("engine"),this.entity.element.on("click",function(t){console.log("The button called "+this.type+" was clicked."),this.engine.script.messageController.sendMessage(this.type,0)},this)};var CoinsController=pc.createScript("coinsController");CoinsController.prototype.initialize=function(){this.entity.element.text=0,this.targetCoins=0,this.totalAmount=0},CoinsController.prototype.update=function(t){0!==this.targetCoins&&(this.targetCoins-=15*t,this.entity.element.text=this.totalAmount-Math.round(this.targetCoins),this.targetCoins<.5&&(this.targetCoins=0))},CoinsController.prototype.addCoins=function(t){this.totalAmount=+this.totalAmount+t,this.targetCoins=t},CoinsController.prototype.addCoinsFromSave=function(t){this.totalAmount=+this.totalAmount+t,this.entity.element.text=this.totalAmount};var LivesController=pc.createScript("livesController");LivesController.prototype.initialize=function(){this.lives=3,this.entity.element.text=3},LivesController.prototype.remove=function(){this.lives>0&&(this.lives--,this.entity.element.text=this.lives)},LivesController.prototype.save=function(){return{lives:this.lives}},LivesController.prototype.load=function(e){this.lives=e.lives,this.entity.element.text=this.lives};var ChestController=pc.createScript("chestController");ChestController.prototype.initialize=function(){this.app=pc.Application.getApplication()},ChestController.attributes.add("looted",{type:"boolean",default:!1}),ChestController.attributes.add("coinsValue",{type:"number",default:50}),ChestController.attributes.add("lootType",{type:"string",default:"coins"}),ChestController.prototype.use=function(){!1===this.looted?(this.loot(),this.looted=!0):this.app.root.findByName("character").script.commandInterpreter.doNextCommand()},ChestController.prototype.loot=function(){"coins"===this.lootType?this.app.root.findByName("coins").script.coinsController.addCoins(this.coinsValue):this.app.root.findByName("leftUIInventory").script.inventoryController.add(this.lootType),this.app.root.findByName("character").script.commandInterpreter.doNextCommand()},ChestController.prototype.lootFromSave=function(){"coins"===this.lootType&&this.app.root.findByName("coins").script.coinsController.addCoinsFromSave(this.coinsValue)},ChestController.prototype.load=function(t){t?(this.looted=!0,this.lootFromSave()):this.looted=!1};var LootController=pc.createScript("lootController");LootController.prototype.initialize=function(){this.looted=!1,this.app=pc.Application.getApplication()},LootController.attributes.add("lootType",{type:"string",default:"goldenKey"}),LootController.attributes.add("looted",{type:"boolean",default:!1}),LootController.prototype.loot=function(){this.looted||(this.app.root.findByName("leftUIInventory").script.inventoryController.add(this.lootType),this.entity.sprite.opacity=0,this.looted=!0)},LootController.prototype.save=function(){return this.looted},LootController.prototype.load=function(t){t.looted?(this.looted=!0,this.entity.sprite.opacity=0):(this.looted=!1,this.entity.sprite.opacity=1)};var InventoryController=pc.createScript("inventoryController");InventoryController.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.freeSlots=[0,1,2,3,4,5,6,7],this.slots=["empty","empty","empty","empty","empty","empty","empty","empty"];for(var t=0;t<8;t++){var e="Slot"+this.freeSlots[t];this.app.root.findByName(e).element.opacity=0}},InventoryController.prototype.save=function(){return{slots:this.slots}},InventoryController.prototype.load=function(t){this.freeSlots=[0,1,2,3,4,5,6,7],this.slots=["empty","empty","empty","empty","empty","empty","empty","empty"];for(var e=0;e<8;e++){var o="Slot"+e;this.slots[e]=t.slots[e],"empty"!==this.slots[e]?this.add(this.slots[e]):this.app.root.findByName(o).element.opacity=0}console.log(this.freeSlots),console.log(this.slots)},InventoryController.prototype.add=function(t){if(7!=this.freeSlots[0]){this.freeSlots[0];switch(t){case"goldenKey":13845451;break;case"silverKey":case"door1Key":case"door2Key":13845453}this.slots[this.freeSlots[0]]=t,this.freeSlots.splice(0,1),console.log("INVENTORY: added  "+t)}},InventoryController.prototype.checkInventoryFor=function(t){for(var e=!1,o=0;o<8;o++)if(this.slots[o]===t){e=!0;break}return e};var TileController=pc.createScript("tileController");TileController.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.attributesArray=["move","destructible","use","open","drop","death","button"]},TileController.attributes.add("move",{type:"boolean",default:!0}),TileController.attributes.add("destructible",{type:"boolean",default:!1}),TileController.attributes.add("use",{type:"boolean",default:!1}),TileController.attributes.add("open",{type:"boolean",default:!1}),TileController.attributes.add("drop",{type:"boolean",default:!1}),TileController.attributes.add("death",{type:"boolean",default:!1}),TileController.attributes.add("button",{type:"boolean",default:!1}),TileController.attributes.add("saveEnabled",{type:"boolean",default:!1}),TileController.attributes.add("saveAttribute",{type:"string",default:""}),TileController.attributes.add("saveType",{type:"string",default:""}),TileController.prototype.getValueOfAttribute=function(t){switch(t){case"move":return this.move;case"destructible":return this.destructible;case"use":return this.use;case"open":return this.open;case"drop":return this.drop;case"death":return this.death;case"button":return this.button}},TileController.prototype.setValueOfAttribute=function(t,e){switch(t){case"move":this.changeMove(e);break;case"destructible":this.changeDestructible(e);break;case"use":this.changeUse(e);break;case"open":this.changeOpen(e);break;case"drop":this.changeDrop(e);break;case"death":this.changeDeath(e);break;case"button":this.changeButton(e)}},TileController.prototype.changeMove=function(t){this.move=0!==t&&!1!==t},TileController.prototype.changeDestructible=function(t){this.destructible=0!==t&&!1!==t},TileController.prototype.changeUse=function(t){this.use=0!==t&&!1!==t},TileController.prototype.changeOpen=function(t){this.open=0!==t&&!1!==t},TileController.prototype.changeDrop=function(t){this.drop=0!==t&&!1!==t},TileController.prototype.changeDeath=function(t){this.death=0!==t&&!1!==t},TileController.prototype.changeButton=function(t){this.button=0!==t&&!1!==t},TileController.prototype.save=function(){var t=this.saveType.split(","),e=this.saveAttribute.split(","),o={};if(""!==e[0])for(var r in e)o[e[r]]=this.getValueOfAttribute(e[r]);if(""!==t[0])for(var i in t){var l=this.entity.script.tileScript.save(t[i]);for(var a in l)o[a]=l[a]}return o},TileController.prototype.load=function(t){var e;console.log(t),console.log(this.entity.name);var o=this.saveType.split(",");if(""!==o[0])for(var r in o)this.entity.script.tileScript.load(t,o[r]);var i=this.saveAttribute.split(",");if(""!==i[0])for(var l in i)e=i[l],t.hasOwnProperty(e)&&(t[e]?this.setValueOfAttribute(e,!0):this.setValueOfAttribute(e,!1))};var SaveAndLoadController=pc.createScript("saveAndLoadController");SaveAndLoadController.attributes.add("scriptNames",{type:"string",default:""}),SaveAndLoadController.prototype.save=function(){var t={},i=this.scriptNames.split(",");if(""!==i[0])for(var e in i)if(this.entity.script.has(i[e])){var r=this.entity.script[i[e]].save();for(var n in r)t[n]=r[n]}else console.log("SAVE ERROR: Script: "+i[e]+"is not present in this entity: "+this.entity.name);return t},SaveAndLoadController.prototype.load=function(t){var i=this.scriptNames.split(",");if(""!==i[0])for(var e in i)this.entity.script.has(i[e])?this.entity.script[i[e]].load(t):console.log("LOAD ERROR: Script: "+i[e]+"is not present in this entity: "+this.entity.name)};var TrapController=pc.createScript("trapController");TrapController.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.defaultOpened?(this.entity.sprite.play("opened"),this.entity.script.tileController.changeDeath(1)):(this.entity.sprite.play("closed"),this.entity.script.tileController.changeDeath(0)),this.opened=this.defaultOpened},TrapController.attributes.add("defaultOpened",{type:"boolean",default:!1}),TrapController.prototype.use=function(){this.opened?(this.opened=!1,this.close()):(this.opened=!0,this.open())},TrapController.prototype.open=function(){this.entity.sprite.play("opened"),this.entity.script.tileController.changeDeath(1),this.app.root.findByName("character").script.commandInterpreter.doNextCommand()},TrapController.prototype.close=function(){this.entity.sprite.play("closed"),this.entity.script.tileController.changeDeath(0),this.app.root.findByName("character").script.commandInterpreter.doNextCommand()},TrapController.prototype.save=function(){return{opened:this.opened}},TrapController.prototype.load=function(t){t==this.defaultOpened?(this.opened=!1,this.entity.sprite.play("closed"),this.entity.script.tileController.changeDeath(0)):(this.opened=!0,this.entity.sprite.play("opened"),this.entity.script.tileController.changeDeath(1))};var TileScript=pc.createScript("tileScript");TileScript.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.targetEntity=this.app.root.findByName(this.targetType+this.entity.name)},TileScript.attributes.add("targetType",{type:"string",default:""}),TileScript.prototype.destroy=function(){this.entity.script.tileController.changeMove(1),this.entity.script.tileController.changeDestructible(0),this.targetEntity.script.destructionController.destroy()},TileScript.prototype.loot=function(){this.entity.script.tileController.changeDrop(0),this.targetEntity.script.lootController.loot()},TileScript.prototype.use=function(){this.targetEntity.script.useController.use()},TileScript.prototype.save=function(t){var e;switch(t){case"destroy":e={destroyed:this.targetEntity.script.destructionController.save()};break;case"door":e={opened:this.targetEntity.script.doorController.save()};break;case"loot":e={looted:this.targetEntity.script.lootController.save()};break;case"use":e={used:this.targetEntity.script.useController.save()};break;case"state":e=this.targetEntity.script.stateController.save()}return e},TileScript.prototype.load=function(t,e){switch(e){case"destroy":this.targetEntity.script.destructionController.load(t),t.destroyed?(this.entity.script.tileController.changeMove(1),this.entity.script.tileController.changeDestructible(0)):(this.entity.script.tileController.changeMove(0),this.entity.script.tileController.changeDestructible(1));break;case"door":break;case"loot":this.targetEntity.script.lootController.load(t),t.looted?this.entity.script.tileController.changeDrop(0):this.entity.script.tileController.changeDrop(1);break;case"use":this.targetEntity.script.useController.load(t);break;case"state":this.targetEntity.script.stateController.load(t)}};var TaskController=pc.createScript("taskController");TaskController.attributes.add("level",{type:"string",default:"1x1"}),TaskController.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.engine=this.app.root.findByName("engine"),this.mainTaskArray=[],this.continueGameAfterTask=-1},TaskController.prototype.getCurrentMainTask=function(){for(var e=[],s=0;s<this.mainTaskArray.length;s++)if("active"==this.mainTaskArray[s][2]){e=this.mainTaskArray[s].slice();break}return e},TaskController.prototype.changeMainTaskState=function(e,s){this.mainTaskArray[e][2]=s},TaskController.prototype.taskWasCompleted=function(e){this.app.root.findByName("character").sprite.play("idle"),this.changeMainTaskState(e,"completed"),console.log("TASK CONTROLLER.js: task"+e+"was completed"),console.log("TASK CONTROLLER.js: mainTaskArray:"),console.log(this.mainTaskArray),this.engine.script.messageController.sendMessage("mainTaskCompleted",{currentMainTask:e,commandArray:this.entity.script.commandInterpreter.commandArray})},TaskController.prototype.continueGame=function(){switch(this.continueGameAfterTask++,console.log("TASK CONTROLLER.js: continue game, case"+this.continueGameAfterTask),this.level){case"1x1":this.continueGame1x1();break;case"1x2":this.continueGame1x2();break;case"1x3":this.continueGame1x3();break;case"1x4":this.continueGame1x4();break;case"1x5":this.continueGame1x5();break;case"2x1":this.continueGame2x1();break;case"2x2":this.continueGame2x2();break;case"2x3":this.continueGame2x3();break;case"2x4":this.continueGame2x4();break;case"2x5":this.continueGame2x5()}},TaskController.prototype.continueGame1x1=function(){switch(this.continueGameAfterTask){case 0:this.app.root.findByName("6x6").script.tileController.changeMove(1),this.app.root.findByName("door1").script.stateController.changeState(1),this.app.root.findByName("door1").script.stateController.changeDrawOrder(4),this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.app.root.findByName("6x9").script.tileController.changeMove(0),this.app.root.findByName("door2").script.stateController.changeState(0),this.app.root.findByName("door2").script.stateController.changeDrawOrder(1),this.app.root.findByName("5x8").sprite.drawOrder=0,this.engine.script.messageController.sendMessage("nextMainTask",2);break;case 3:this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.engine.script.messageController.sendMessage("nextMainTask",3);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.continueGame1x2=function(){switch(this.continueGameAfterTask){case 0:this.app.root.findByName("6x9").script.tileController.changeMove(1),this.app.root.findByName("7x9").script.tileController.changeMove(1),this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.engine.script.messageController.sendMessage("nextMainTask",2);break;case 3:this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(3.5),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-9),this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.engine.script.messageController.sendMessage("nextMainTask",3);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.continueGame1x3=function(){switch(this.continueGameAfterTask){case 0:this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.engine.script.messageController.sendMessage("nextMainTask",2),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(6.5),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-9);break;case 3:this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.engine.script.messageController.sendMessage("nextMainTask",3);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("nextMainTask",4);break;case 7:this.changeMainTaskState(4,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 8:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.continueGame1x4=function(){switch(this.continueGameAfterTask){case 0:this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.engine.script.messageController.sendMessage("nextMainTask",2),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(6.5),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-9);break;case 3:this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.engine.script.messageController.sendMessage("nextMainTask",3);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.continueGame1x5=function(){switch(this.continueGameAfterTask){case 0:this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.engine.script.messageController.sendMessage("nextMainTask",2),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(6.5),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-9),this.app.root.findByName("door2").script.stateController.changeState(1),this.app.root.findByName("9x6").script.tileController.changeMove(1),this.app.root.findByName("10x6").script.tileController.changeMove(1);break;case 3:this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.engine.script.messageController.sendMessage("nextMainTask",3);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("nextMainTask",4);break;case 7:this.changeMainTaskState(4,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 8:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.continueGame2x1=function(){switch(this.continueGameAfterTask){case 0:this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.engine.script.messageController.sendMessage("nextMainTask",2),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(4),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-5);break;case 3:this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.engine.script.messageController.sendMessage("nextMainTask",3),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(6),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-5);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.continueGame2x2=function(){switch(this.continueGameAfterTask){case 0:this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.engine.script.messageController.sendMessage("nextMainTask",2),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(3),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-5);break;case 3:this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.app.root.findByName("door2").script.stateController.changeState(1),this.app.root.findByName("9x11").script.tileController.changeMove(1),this.app.root.findByName("10x11").script.tileController.changeMove(1),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(6),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-5),this.engine.script.messageController.sendMessage("nextMainTask",3);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("nextMainTask",4);break;case 7:this.changeMainTaskState(4,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 8:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.continueGame2x3=function(){switch(this.continueGameAfterTask){case 0:this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.engine.script.messageController.sendMessage("nextMainTask",2),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(3),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-5);break;case 3:this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.engine.script.messageController.sendMessage("nextMainTask",3);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("nextMainTask",4),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(5),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-5);break;case 7:this.changeMainTaskState(4,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 8:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.continueGame2x4=function(){switch(this.continueGameAfterTask){case 0:this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(3),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-5),this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.engine.script.messageController.sendMessage("nextMainTask",2);break;case 3:this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(6.5),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-9),this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.engine.script.messageController.sendMessage("nextMainTask",3);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.continueGame2x5=function(){switch(this.continueGameAfterTask){case 0:this.engine.script.messageController.sendMessage("nextMainTask",1);break;case 1:this.changeMainTaskState(1,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 2:this.app.root.findByName("door2").script.stateController.changeState(1),this.app.root.findByName("9x9").script.tileController.changeMove(1),this.app.root.findByName("10x9").script.tileController.changeMove(1),this.app.root.findByName("camera").script.cameraController.changeCurrentXMax(6),this.app.root.findByName("camera").script.cameraController.changeDistanceX(-3),this.engine.script.messageController.sendMessage("nextMainTask",2);break;case 3:this.changeMainTaskState(2,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 4:this.engine.script.messageController.sendMessage("nextMainTask",3);break;case 5:this.changeMainTaskState(3,"active"),this.engine.script.engineController.save(),this.engine.script.messageController.sendMessage("unlock",0);break;case 6:this.engine.script.messageController.sendMessage("allMainTasksFinished",0)}},TaskController.prototype.save=function(){return{mainTaskArray:this.mainTaskArray,continueGameAfterTask:this.continueGameAfterTask}},TaskController.prototype.load=function(e){this.mainTaskArray=e.mainTaskArray,this.continueGameAfterTask=e.continueGameAfterTask};var TaskScript=pc.createScript("taskScript");TaskScript.attributes.add("taskNumber",{type:"number",default:0}),TaskScript.attributes.add("onMove",{type:"boolean",default:!1}),TaskScript.attributes.add("onMoveAndHasLoot",{type:"boolean",default:!1}),TaskScript.attributes.add("hasLootType",{type:"string",default:""}),TaskScript.attributes.add("onDestruction",{type:"boolean",default:!1}),TaskScript.attributes.add("onUse",{type:"boolean",default:!1}),TaskScript.attributes.add("onOpen",{type:"boolean",default:!1}),TaskScript.prototype.initialize=function(){this.app=pc.Application.getApplication()},TaskScript.prototype.checkEvent=function(t,e){if(e!==this.taskNumber)this.app.root.findByName("character").script.commandInterpreter.taskWasNotCompleted(e);else switch(t){case"moved":this.onMove?this.app.root.findByName("character").script.taskController.taskWasCompleted(this.taskNumber):this.app.root.findByName("character").script.commandInterpreter.taskWasNotCompleted(this.taskNumber);break;case"movedAndHasLoot":var a=this.app.root.findByName("leftUIInventory").script.inventoryController.checkInventoryFor(this.hasLootType);this.onMoveAndHasLoot&&a?this.app.root.findByName("character").script.taskController.taskWasCompleted(this.taskNumber):this.app.root.findByName("character").script.commandInterpreter.taskWasNotCompleted(this.taskNumber);break;case"destroyed":this.onDestruction?this.app.root.findByName("character").script.taskController.taskWasCompleted(this.taskNumber):this.app.root.findByName("character").script.commandInterpreter.taskWasNotCompleted(this.taskNumber);break;case"used":this.onUse?this.app.root.findByName("character").script.taskController.taskWasCompleted(this.taskNumber):this.app.root.findByName("character").script.commandInterpreter.taskWasNotCompleted(this.taskNumber);break;case"opened":this.onOpen?this.app.root.findByName("character").script.taskController.taskWasCompleted(this.taskNumber):this.app.root.findByName("character").script.commandInterpreter.taskWasNotCompleted(this.taskNumber)}};var MessageController=pc.createScript("messageController");MessageController.prototype.initialize=function(){self=this,window.addEventListener("message",function(e){var t=e.data.message;self.interpretMessage(t)},!1),this.app=pc.Application.getApplication(),this.commandTypes=["move","jump","attack","open","use","rotate","doWhile","for","};","if"]},MessageController.prototype.interpretMessage=function(e){var t=this.app.root.findByName("engine"),a=this.app.root.findByName("camera");this.app.root.findByName("character");switch(e.split("\n")[0]){case"camera+":a.camera.orthoHeight>0&&(a.camera.orthoHeight=+a.camera.orthoHeight-.5);break;case"camera-":a.camera.orthoHeight<10&&(a.camera.orthoHeight=+a.camera.orthoHeight+.5);break;case"save":t.script.engineController.save();break;case"load":t.script.engineController.load(e);break;case"start":t.script.engineController.start(e);break;case"continue":t.script.engineController.continue();break;case"stopExecution":t.script.engineController.stopExecution();break;default:this.createCommandBuffer(e,!0)}},MessageController.prototype.createCommandBuffer=function(e,t){var a=e.split("\n"),r=[],o=[],s=!1;for(var n in a)if("Player:"==a[n]&&(s=!0),s){for(var i=0;i<this.commandTypes.length;i++)if(a[n].startsWith("  ")&&(a[n]=a[n].trim()),a[n].startsWith(this.commandTypes[i])){r.push(a[n]),o.push(a[n-1]);break}if(""===a[n])break}this.app.root.findByName("character").script.commandInterpreter.commandBufferReceiver(r,o,t)},MessageController.prototype.sendMessage=function(e,t){var a={action:e,content:t};parent.postMessage(a,"http://localhost:3000")};var StateController=pc.createScript("stateController");StateController.attributes.add("defaultState",{type:"number",default:0}),StateController.attributes.add("defaultDrawOrder",{type:"number",default:0}),StateController.prototype.save=function(){return{state:this.state,drawOrder:this.drawOrder}},StateController.prototype.load=function(t){this.changeState(t.state),this.changeDrawOrder(t.drawOrder)},StateController.prototype.initialize=function(){this.changeState(this.defaultState),this.changeDrawOrder(this.defaultDrawOrder)},StateController.prototype.changeState=function(t){switch(t){case 0:this.state=0,this.entity.sprite.play("0");break;case 1:this.state=1,this.entity.sprite.play("1")}},StateController.prototype.changeDrawOrder=function(t){this.drawOrder=t,this.entity.sprite.drawOrder=t};var DoorController=pc.createScript("doorController");DoorController.attributes.add("defaultOpened",{type:"boolean",default:!1}),DoorController.attributes.add("changeDrawOrder",{type:"boolean",default:!1}),DoorController.attributes.add("targetTile",{type:"string",default:""}),DoorController.attributes.add("targetTile2",{type:"string",default:""}),DoorController.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.defaultOpened?(this.app.root.findByName(this.targetTile).script.tileController.changeMove(1),this.app.root.findByName(this.targetTile2).script.tileController.changeMove(1),this.entity.sprite.play("opened"),this.changeDrawOrder&&(this.entity.sprite.drawOrder=5)):(this.app.root.findByName(this.targetTile).script.tileController.changeMove(0),this.app.root.findByName(this.targetTile2).script.tileController.changeMove(0),this.entity.sprite.play("closed"),this.changeDrawOrder&&(this.entity.sprite.drawOrder=1)),this.opened=this.defaultOpened},DoorController.prototype.use=function(){this.opened?(this.opened=!1,this.close()):(this.opened=!0,this.open())},DoorController.prototype.open=function(){this.entity.sprite.play("open"),this.entity.sprite.once("end",function(){this.entity.sprite.play("opened"),this.app.root.findByName(this.targetTile).script.tileController.changeMove(1),this.app.root.findByName(this.targetTile2).script.tileController.changeMove(1),this.changeDrawOrder&&(this.entity.sprite.drawOrder=5),this.app.root.findByName("character").script.commandInterpreter.doNextCommand()},this)},DoorController.prototype.close=function(){this.entity.sprite.play("close"),this.entity.sprite.once("end",function(){this.entity.sprite.play("closed"),this.app.root.findByName(this.targetTile).script.tileController.changeMove(0),this.app.root.findByName(this.targetTile2).script.tileController.changeMove(0),this.changeDrawOrder&&(this.entity.sprite.drawOrder=1),this.app.root.findByName("character").script.commandInterpreter.doNextCommand()},this)},DoorController.prototype.save=function(){return this.opened},DoorController.prototype.load=function(t){t!==this.defaultOpened?(this.opened=!0,this.app.root.findByName(this.targetTile).script.tileController.changeMove(1),this.app.root.findByName(this.targetTile2).script.tileController.changeMove(1),this.entity.sprite.play("opened"),this.changeDrawOrder&&(this.entity.sprite.drawOrder=5)):(this.opened=!1,this.app.root.findByName(this.targetTile).script.tileController.changeMove(0),this.app.root.findByName(this.targetTile2).script.tileController.changeMove(0),this.entity.sprite.play("closed"),this.changeDrawOrder&&(this.entity.sprite.drawOrder=1))};var EngineController=pc.createScript("engineController");EngineController.attributes.add("levelSizeX",{type:"number"}),EngineController.attributes.add("levelSizeY",{type:"number"}),EngineController.attributes.add("loadSavedGameAtStart",{type:"boolean",default:!1}),EngineController.attributes.add("entitiesToSaveAndLoad",{type:"string",default:""}),EngineController.prototype.initialize=function(){this.app=pc.Application.getApplication(),this.saveAndLoadObject={},this.introductionCompleted=!1,this.app.root.findByName("version").element.text="1.0.0 (19.04)",this.notifyStart()},EngineController.prototype.save=function(){var t,e=this.entitiesToSaveAndLoad.split(",");if(""!==e[0])for(var o in e)console.log("saving at saveandload controller of "+e[o]),this.saveAndLoadObject[e[o]]=this.app.root.findByName(e[o]).script.saveAndLoadController.save();for(var n=0;n<=this.levelSizeX;n++)for(var r=0;r<=this.levelSizeY;r++)t=n+"x"+r,console.log(t),void 0!==this.app.root.findByName(t).script&&this.app.root.findByName(t).script.has("tileController")&&this.app.root.findByName(t).script.tileController.saveEnabled&&(console.log("saving at tile controller of "+t),this.saveAndLoadObject[t]=this.app.root.findByName(t).script.tileController.save());console.log("GAME: saving"),this.entity.script.messageController.sendMessage("save",this.saveAndLoadObject)},EngineController.prototype.load=function(t){console.log("GAME: loading"),console.log(t),this.app.root.findByName("coins").script.coinsController.initialize();var e=t.split("\n");for(var o in this.saveAndLoadObject=JSON.parse(e[1]),console.log(this.saveAndLoadObject),this.saveAndLoadObject)this.app.root.findByName(o).script.has("tileController")?this.app.root.findByName(o).script.tileController.saveEnabled&&(console.log("loading at tile controller of "+o),this.app.root.findByName(o).script.tileController.load(this.saveAndLoadObject[o])):(console.log("loading at saveandload controller of "+o),this.app.root.findByName(o).script.saveAndLoadController.load(this.saveAndLoadObject[o]));if(this.introductionCompleted)this.entity.script.messageController.sendMessage("unlock",0);else{var n=this.app.root.findByName("character").script.taskController.getCurrentMainTask();this.entity.script.messageController.sendMessage("introduction",n[3])}},EngineController.prototype.start=function(t){this.loadSavedGameAtStart?this.load(t):this.entity.script.messageController.sendMessage("unlock",0),this.app.root.findByName("loadingBackground").element.enabled=!1},EngineController.prototype.continue=function(){console.log("continue"),this.introductionCompleted?this.app.root.findByName("character").script.taskController.continueGame():(this.introductionCompleted=!0,this.entity.script.messageController.sendMessage("unlock",0))},EngineController.prototype.stopExecution=function(){var t=this.app.root.findByName("character"),e=t.script.taskController.getCurrentMainTask(),o=t.script.commandInterpreter.commandArray,n={sPX:t.script.commandInterpreter.startingPositionX,sPY:t.script.commandInterpreter.startingPositionY,lSX:t.script.commandInterpreter.levelSizeX,lSY:t.script.commandInterpreter.levelSizeY,mS:t.script.commandInterpreter.moveSpeed};t.script.destroy("commandInterpreter"),t.script.create("commandInterpreter",{attributes:{startingPositionX:n.sPX,startingPositionY:n.sPY,levelSizeX:n.lSX,levelSizeY:n.lSY,moveSpeed:n.mS}}),t.script.commandInterpreter.initializeAfterStoppedExecution(this.saveAndLoadObject.character.currentTile[0],this.saveAndLoadObject.character.currentTile[1]),this.entity.script.messageController.sendMessage("stoppedExecution",{currentMainTask:e[3],commandArray:o})},EngineController.prototype.notifyStart=function(){this.entity.script.messageController.sendMessage("start",0)};